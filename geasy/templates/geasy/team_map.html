{% extends 'base.html' %}

{% block title %}Working Team Locations{% endblock %}

{% block content %}
<h2>Working Team Locations - {{ today }}</h2>

{% if team_locations %}
<div id="map" style="height: 500px;"></div>

<script>
    const map = L.map('map').setView([20.5937, 78.9629], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    
    {% for member in team_locations %}
    L.marker([{{ member.lat }}, {{ member.lng }}])
        .addTo(map)
        .bindPopup(`
            <b>{{ member.name }}</b><br>
            ID: {{ member.emp_id }}<br>
            Last seen: {{ member.timestamp }}
        `);
    {% endfor %}
    
    // Fit map to markers
    const group = new L.featureGroup([
        {% for member in team_locations %}
        L.marker([{{ member.lat }}, {{ member.lng }}]){% if not loop.last %},{% endif %}
        {% endfor %}
    ]);
    map.fitBounds(group.getBounds().pad(0.2));
</script>
{% endif %}

<div class="mt-4">
    <h4>Location Summary</h4>
    
    {% if team_locations %}
    <div class="alert alert-success">
        <strong>{{ team_locations|length }} employees</strong> with GPS coordinates
    </div>
    {% endif %}
    
    {% if text_locations %}
    <div class="alert alert-info">
        <strong>{{ text_locations|length }} employees</strong> with text locations (not shown on map):
        <ul class="mt-2">
            {% for member in text_locations %}
            <li>{{ member.name }} ({{ member.emp_id }}): {{ member.location }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if not team_locations and not text_locations %}
    <div class="alert alert-warning">
        No location data available for today.
    </div>
    {% endif %}
</div>
{% endblock %}