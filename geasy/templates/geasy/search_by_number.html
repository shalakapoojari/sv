{% extends 'geasy/navbar.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Report by Chassis Number</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='geasy/css/styles.css') }}">
</head>
<body>
    <div class="page-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="search-bar">
            <form method="POST" class="search-form">
                <label for="search_date">Select Month:</label>
                <select name="search_month" class="form-control" required>
                    <option value="">---</option>
                    {% for i in range(1, 13) %}
                        <option value="{{ i }}" {% if request.form.get('search_month') == i|string %}selected{% endif %}>
                            {{ ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'July', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][i-1] }}
                        </option>
                    {% endfor %}
                </select>
                <label for="search_year">Select Year:</label>
                <select name="search_year" class="form-control" required>
                    <option value="">---</option>
                    {% for y in range(2023, 2031) %}
                        <option value="{{ y }}" {% if request.form.get('search_year') == y|string %}selected{% endif %}>{{ y }}</option>
                    {% endfor %}
                </select>
                <label for="search_number">Chassis Number:</label>
                <input type="text" name="search_number" class="form-control" minlength="6" required 
                       value="{{ search_number or '' }}" placeholder="Chassis Number">
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>

        {% if report %}
            <div class="section-title">
                Results for chassis "{{ search_number }}" in {{ selected_date }}
                <span class="record-count">{{ report|length }} records</span>
            </div>
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Login ID</th>
                            <th>Employee Name</th>
                            <th>Date Accessed</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in report %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ row.login_id }}</td>
                                <td>{{ row.emp_name }}</td>
                                <td>{{ row.search_date }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% elif selected_date %}
            <div class="no-results">No results found for chassis {{ search_number }} in {{ selected_date }}.</div>
        {% endif %}
    </div>
</body>
</html>
{% endblock %}
